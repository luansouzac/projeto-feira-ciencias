import{_ as Ae,u as Me,e as m,g as he,v as Oe,l as k,m as ue,c as g,w as t,r as n,f as Ue,o as d,a,h as D,k as z,p as Re,d as s,t as c,b as v,F as W,i as G,j as K,n as Ie}from"./index-zSKt_z7e.js";const Be={key:0,class:"text-center py-16"},qe={key:2},Le={class:"text-h4 font-weight-bold"},He={class:"d-flex align-center mb-4"},Je={class:"font-weight-bold text-grey-darken-3"},Qe={key:0,class:"text-caption font-weight-regular text-grey-darken-1 mt-1"},We={key:1,class:"mt-3 d-flex flex-wrap ga-2"},Ge={class:"text-h6"},Ke={class:"font-weight-bold text-h6 text-grey-darken-4"},Xe={class:"text-body-2 text-grey-darken-2 mt-1"},Ye={key:0,class:"text-center text-grey-darken-1 pa-4"},Ze={class:"feedback-item"},ea={class:"font-italic"},aa={class:"text-caption text-grey-darken-1 mt-1"},ta={__name:"OrientadorProjectView",setup(oa){const oe=Ue(),ce=Oe(),x=Me(),X=m(!0),R=m(null),y=m(null),T=m([]),C=m([]),I=m("kanban"),B=m(!1),q=m(!1),b=m(null),A=m(""),j=m(!1),L=m(!1),S=m(null),_=m({descricao:"",detalhe:"",data_inicio_prevista:null,data_fim_prevista:null,data_conclusao:null,id_usuario_atribuido:null}),M=m(!1),$=m(null);he(async()=>{const o=ce.params.id;if(!o){R.value="ID do projeto não fornecido.",X.value=!1;return}try{const[e,r,u]=await Promise.all([k.get(`/projetos/${o}`),k.get(`/projetos/${o}/tarefas`),k.get(`/membros_projeto/${o}`)]);y.value=e.data.data||e.data,C.value=u.data.data||u.data||[];const f=r.data.data||r.data||[];if(Array.isArray(f)&&f.length>0){const V=f.map(E=>{const w=k.get(`/registros_tarefas?id_tarefa=${E.id_tarefa}`).catch(()=>({data:[]})),p=k.get(`/tarefas/${E.id_tarefa}/feedbacks`).catch(()=>({data:[]}));return Promise.all([w,p])}),h=await Promise.all(V);f.forEach((E,w)=>{const[p,F]=h[w],O=p.data.data||p.data||[];O.length>0&&(E.id_usuario_atribuido=O[O.length-1].id_responsavel),E.feedbacks=F.data.data||F.data||[]})}T.value=f}catch(e){console.error("Erro ao buscar dados do projeto:",e),R.value="Não foi possível carregar os dados do projeto. Tente novamente."}finally{X.value=!1}});const ve={1:{text:"Em Análise",color:"orange-darken-2",icon:"mdi-file-search-outline"},2:{text:"Aprovado",color:"green-darken-2",icon:"mdi-check-decagram-outline"}},fe=[{title:"A Fazer",status:1,color:"grey"},{title:"Em Andamento",status:2,color:"blue"},{title:"Concluído",status:3,color:"green"}];ue(()=>y.value?ve[y.value.id_situacao]||{text:"Desconhecido",color:"grey"}:{});const me=ue(()=>S.value?"Editar Tarefa":"Nova Tarefa"),le=o=>T.value.filter(e=>e.id_situacao===o),pe=()=>{y.value&&oe.push(`/gerenciar-projeto/${y.value.id_projeto}`)},_e=o=>{if(!o||!C.value||C.value.length===0)return"Não atribuído";const e=C.value.find(r=>r.id_usuario===o);return e?e.usuario.nome:"Não atribuído"},ge=(o,e)=>{o.dataTransfer.clearData(),o.dataTransfer.setData("text/plain",String(e.id_tarefa)),o.dataTransfer.dropEffect="move"},be=async(o,e)=>{const r=o.dataTransfer.getData("text/plain"),u=T.value.find(f=>f.id_tarefa==r);if(u&&u.id_situacao!==e){const f=u.id_situacao;u.id_situacao=e;try{await k.put(`/tarefas/${r}`,{id_situacao:e}),x.showSuccess("Status da tarefa atualizado!")}catch(V){u.id_situacao=f,x.showError("Não foi possível atualizar o status da tarefa."),console.error("Erro ao mover tarefa:",V)}}},ke=o=>{b.value=o,A.value="",B.value=!0},Y=()=>{B.value=!1,setTimeout(()=>{b.value=null},300)},xe=async()=>{if(!A.value.trim()){x.showWarning("O feedback não pode estar vazio.");return}q.value=!0;try{const o=await k.post(`/tarefas/${b.value.id_tarefa}/feedbacks`,{feedback:A.value});b.value.feedbacks||(b.value.feedbacks=[]),b.value.feedbacks.push(o.data),x.showSuccess("Feedback enviado com sucesso!"),Y()}catch(o){console.error("Erro ao submeter feedback:",o),x.showError("Não foi possível enviar o feedback.")}finally{q.value=!1}},ye=()=>{S.value=null,_.value={descricao:"",detalhe:"",data_inicio_prevista:null,data_fim_prevista:null,data_conclusao:null,id_usuario_atribuido:null},j.value=!0},we=o=>{S.value=o,_.value={...o},j.value=!0},Te=async()=>{L.value=!0;try{let o;const{id_usuario_atribuido:e,...r}=_.value;if(S.value){const{data:u}=await k.put(`/tarefas/${S.value.id_tarefa}`,r);o=u.data||u}else{const u={id_projeto:y.value.id_projeto,id_situacao:1,...r},{data:f}=await k.post("/tarefas",u);o=f.data||f}if(e&&await k.post("/registros_tarefas",{id_tarefa:o.id_tarefa,id_responsavel:e,descricao_atividade:"Tarefa atribuída ao responsável.",resultado:null,data_execucao:new Date().toISOString().split("T")[0],arquivo:"null"}),o.id_usuario_atribuido=e,S.value){const u=T.value.findIndex(f=>f.id_tarefa===o.id_tarefa);u!==-1&&(o.feedbacks=T.value[u].feedbacks,T.value[u]=o)}else T.value.push(o);x.showSuccess("Tarefa salva com sucesso!"),j.value=!1}catch(o){console.error("Erro ao salvar a tarefa:",o),x.showError("Não foi possível salvar a tarefa.")}finally{L.value=!1}},Ve=o=>{$.value=o,M.value=!0},De=async()=>{if($.value){x.showInfo("Apagando tarefa...");try{await k.delete(`/tarefas/${$.value.id_tarefa}`),T.value=T.value.filter(o=>o.id_tarefa!==$.value.id_tarefa),x.showSuccess("Tarefa apagada com sucesso!")}catch(o){console.error("Erro ao apagar tarefa:",o),x.showError("Não foi possível apagar a tarefa.")}finally{M.value=!1,$.value=null}}},Ce=o=>o?new Date(o).toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",se=o=>{if(!o)return null;const e=new Date(o),r=e.getTimezoneOffset()*6e4;return new Date(e.getTime()-r).toISOString().split("T")[0]};return(o,e)=>{const r=n("v-btn"),u=n("v-progress-circular"),f=n("v-alert"),V=n("v-col"),h=n("v-row"),E=n("v-card-item"),w=n("v-card"),p=n("v-icon"),F=n("v-tab"),O=n("v-tabs"),H=n("v-card-title"),U=n("v-chip"),ne=n("v-tooltip"),N=n("v-card-text"),P=n("v-spacer"),J=n("v-card-actions"),Z=n("v-window-item"),je=n("v-list-subheader"),Ee=n("v-avatar"),ee=n("v-list-item"),re=n("v-list"),Ne=n("v-window"),ae=n("v-text-field"),ie=n("v-textarea"),ze=n("v-select"),Se=n("v-form"),te=n("v-dialog"),de=n("v-divider"),$e=n("v-timeline-item"),Fe=n("v-timeline"),Pe=n("v-container");return d(),g(Pe,{fluid:""},{default:t(()=>[a(r,{variant:"text","prepend-icon":"mdi-arrow-left",onClick:e[0]||(e[0]=l=>Re(oe).go(-1)),class:"mb-6"},{default:t(()=>[...e[16]||(e[16]=[s(" Voltar ",-1)])]),_:1}),X.value?(d(),D("div",Be,[a(u,{indeterminate:"",color:"green-darken-3",size:"64"})])):R.value?(d(),g(f,{key:1,type:"error",variant:"tonal",prominent:""},{default:t(()=>[s(c(R.value),1)]),_:1})):y.value?(d(),D("div",qe,[a(w,{theme:"dark",class:"mb-8 bg-green-darken-4"},{default:t(()=>[a(E,{class:"pa-4 pa-sm-6"},{default:t(()=>[a(h,{align:"center",justify:"space-between"},{default:t(()=>[a(V,{cols:"12",md:"auto"},{default:t(()=>[e[17]||(e[17]=v("p",{class:"text-overline"},"Acompanhamento de Tarefas",-1)),v("h1",Le,c(y.value.titulo),1)]),_:1}),a(V,{cols:"12",md:"4",class:"mt-4 mt-md-0 text-md-right"},{default:t(()=>[a(r,{size:"large",color:"white",variant:"outlined","prepend-icon":"mdi-cog-outline",onClick:pe,block:""},{default:t(()=>[...e[18]||(e[18]=[s(" Configurar Projeto ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(w,null,{default:t(()=>[a(O,{modelValue:I.value,"onUpdate:modelValue":e[1]||(e[1]=l=>I.value=l),"bg-color":"green-darken-3",color:"white",grow:""},{default:t(()=>[a(F,{value:"kanban"},{default:t(()=>[a(p,{start:""},{default:t(()=>[...e[19]||(e[19]=[s("mdi-view-dashboard-outline",-1)])]),_:1}),e[20]||(e[20]=s("Quadro de Tarefas",-1))]),_:1}),a(F,{value:"membros"},{default:t(()=>[a(p,{start:""},{default:t(()=>[...e[21]||(e[21]=[s("mdi-account-group-outline",-1)])]),_:1}),e[22]||(e[22]=s("Equipe",-1))]),_:1}),a(F,{value:"detalhes"},{default:t(()=>[a(p,{start:""},{default:t(()=>[...e[23]||(e[23]=[s("mdi-text-box-search-outline",-1)])]),_:1}),e[24]||(e[24]=s("Detalhes da Proposta",-1))]),_:1})]),_:1},8,["modelValue"]),a(Ne,{modelValue:I.value,"onUpdate:modelValue":e[3]||(e[3]=l=>I.value=l)},{default:t(()=>[a(Z,{value:"kanban"},{default:t(()=>[a(H,{class:"d-flex justify-space-between align-center"},{default:t(()=>[e[26]||(e[26]=v("span",null,"Andamento",-1)),a(r,{color:"green",variant:"flat",onClick:ye,"prepend-icon":"mdi-plus"},{default:t(()=>[...e[25]||(e[25]=[s(" Nova Tarefa ",-1)])]),_:1})]),_:1}),a(N,{class:"bg-grey-lighten-4 pa-4 pa-md-6"},{default:t(()=>[a(h,null,{default:t(()=>[(d(),D(W,null,G(fe,l=>a(V,{key:l.status,cols:"12",md:"4",onDragover:e[2]||(e[2]=K(()=>{},["prevent"])),onDrop:i=>be(i,l.status)},{default:t(()=>[v("div",{class:Ie(["pa-4 rounded-lg fill-height",`bg-${l.color}-lighten-5`])},[v("div",He,[a(p,{color:l.color,class:"mr-2"},{default:t(()=>[...e[27]||(e[27]=[s("mdi-circle-medium",-1)])]),_:2},1032,["color"]),v("span",Je,c(l.title),1),a(U,{size:"small",color:l.color,class:"ml-2"},{default:t(()=>[s(c(le(l.status).length),1)]),_:2},1032,["color"])]),(d(!0),D(W,null,G(le(l.status),i=>(d(),g(w,{key:i.id_tarefa,class:"mb-3 task-card",theme:"light",variant:"flat",draggable:"true",onDragstart:Q=>ge(Q,i)},{default:t(()=>[a(N,{class:"font-weight-medium text-grey-darken-4 pb-1"},{default:t(()=>[s(c(i.descricao)+" ",1),i.detalhe?(d(),D("p",Qe,c(i.detalhe),1)):z("",!0),i.data_inicio_prevista||i.data_fim_prevista?(d(),D("div",We,[i.data_inicio_prevista?(d(),g(U,{key:0,size:"x-small",color:"blue-grey",variant:"tonal"},{default:t(()=>[a(p,{start:"",icon:"mdi-calendar-arrow-right"}),s(" "+c(se(i.data_inicio_prevista))+" ",1),a(ne,{activator:"parent",location:"top"},{default:t(()=>[...e[28]||(e[28]=[s("Início Previsto",-1)])]),_:1})]),_:2},1024)):z("",!0),i.data_fim_prevista?(d(),g(U,{key:1,size:"x-small",color:"blue-grey",variant:"tonal"},{default:t(()=>[a(p,{start:"",icon:"mdi-calendar-arrow-left"}),s(" "+c(se(i.data_fim_prevista))+" ",1),a(ne,{activator:"parent",location:"top"},{default:t(()=>[...e[29]||(e[29]=[s("Fim Previsto",-1)])]),_:1})]),_:2},1024)):z("",!0)])):z("",!0)]),_:2},1024),a(J,{class:"pt-0 px-4 pb-2"},{default:t(()=>[i.feedbacks&&i.feedbacks.length>0?(d(),g(U,{key:0,size:"x-small","prepend-icon":"mdi-comment-text-multiple-outline",color:"blue-grey",variant:"tonal",label:""},{default:t(()=>[s(c(i.feedbacks.length),1)]),_:2},1024)):z("",!0),i.id_usuario_atribuido?(d(),g(U,{key:1,size:"small",class:"ml-2",color:"green",variant:"tonal",label:""},{default:t(()=>[a(p,{start:"",icon:"mdi-account-outline"}),s(" "+c(_e(i.id_usuario_atribuido)),1)]),_:2},1024)):z("",!0),a(P),a(r,{icon:"mdi-pencil",variant:"text",size:"x-small",onClick:K(Q=>we(i),["stop"])},null,8,["onClick"]),a(r,{icon:"mdi-delete-outline",color:"red",variant:"text",size:"x-small",onClick:K(Q=>Ve(i),["stop"])},null,8,["onClick"]),a(r,{color:"grey-darken-3",variant:"text",size:"small",onClick:K(Q=>ke(i),["stop"])},{default:t(()=>[...e[30]||(e[30]=[s(" Analisar ",-1)])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["onDragstart"]))),128))],2)]),_:2},1032,["onDrop"])),64))]),_:1})]),_:1})]),_:1}),a(Z,{value:"membros"},{default:t(()=>[a(N,{class:"pa-0"},{default:t(()=>[C.value.length>0?(d(),g(re,{key:0,lines:"two"},{default:t(()=>[a(je,null,{default:t(()=>[...e[31]||(e[31]=[s("Membros da Equipe",-1)])]),_:1}),(d(!0),D(W,null,G(C.value,l=>(d(),g(ee,{key:l.id_usuario,title:l.usuario.nome,subtitle:l.usuario.email},{prepend:t(()=>[a(Ee,{color:"green-darken-4"},{default:t(()=>[v("span",Ge,c(l.usuario.nome.charAt(0)),1)]),_:2},1024)]),_:2},1032,["title","subtitle"]))),128))]),_:1})):(d(),g(f,{key:1,type:"info",variant:"tonal",class:"ma-4"},{default:t(()=>[...e[32]||(e[32]=[s("Nenhum membro na equipe deste projeto.",-1)])]),_:1}))]),_:1})]),_:1}),a(Z,{value:"detalhes"},{default:t(()=>[a(N,{class:"pa-4 pa-md-6"},{default:t(()=>[a(re,{lines:"two","bg-color":"transparent"},{default:t(()=>[a(ee,{"prepend-icon":"mdi-lightbulb-on-outline",title:"Problema a ser Resolvido",subtitle:y.value.problema||"Não informado"},null,8,["subtitle"]),a(ee,{class:"mt-4","prepend-icon":"mdi-bullseye-arrow",title:"Relevância e Justificativa",subtitle:y.value.relevancia||"Não informado"},null,8,["subtitle"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})])):z("",!0),a(te,{modelValue:j.value,"onUpdate:modelValue":e[11]||(e[11]=l=>j.value=l),persistent:"","max-width":"700px"},{default:t(()=>[a(w,null,{default:t(()=>[a(H,{class:"d-flex align-center text-h5 bg-green-darken-3 text-white"},{default:t(()=>[s(c(me.value)+" ",1),a(P),a(r,{icon:"mdi-close",variant:"text",onClick:e[4]||(e[4]=l=>j.value=!1)})]),_:1}),a(N,{class:"pt-6"},{default:t(()=>[a(Se,null,{default:t(()=>[a(ae,{modelValue:_.value.descricao,"onUpdate:modelValue":e[5]||(e[5]=l=>_.value.descricao=l),label:"Título da Tarefa",variant:"outlined",rules:[l=>!!l||"O título é obrigatório"],autofocus:""},null,8,["modelValue","rules"]),a(ie,{modelValue:_.value.detalhe,"onUpdate:modelValue":e[6]||(e[6]=l=>_.value.detalhe=l),label:"Descrição Detalhada (Opcional)",variant:"outlined",rows:"3",class:"mt-4"},null,8,["modelValue"]),a(ze,{modelValue:_.value.id_usuario_atribuido,"onUpdate:modelValue":e[7]||(e[7]=l=>_.value.id_usuario_atribuido=l),items:C.value,"item-title":"usuario.nome","item-value":"id_usuario",label:"Atribuir a (Opcional)",variant:"outlined",class:"mt-4",clearable:""},null,8,["modelValue","items"]),a(h,{class:"mt-2"},{default:t(()=>[a(V,{cols:"12",md:"6"},{default:t(()=>[a(ae,{modelValue:_.value.data_inicio_prevista,"onUpdate:modelValue":e[8]||(e[8]=l=>_.value.data_inicio_prevista=l),label:"Início Previsto",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),a(V,{cols:"12",md:"6"},{default:t(()=>[a(ae,{modelValue:_.value.data_fim_prevista,"onUpdate:modelValue":e[9]||(e[9]=l=>_.value.data_fim_prevista=l),label:"Fim Previsto",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),a(J,{class:"pa-4"},{default:t(()=>[a(P),a(r,{color:"grey-darken-1",variant:"text",onClick:e[10]||(e[10]=l=>j.value=!1),disabled:L.value},{default:t(()=>[...e[33]||(e[33]=[s("Cancelar",-1)])]),_:1},8,["disabled"]),a(r,{color:"green-darken-2",variant:"flat",onClick:Te,loading:L.value},{default:t(()=>[...e[34]||(e[34]=[s("Salvar",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(te,{modelValue:B.value,"onUpdate:modelValue":e[13]||(e[13]=l=>B.value=l),persistent:"","max-width":"700px"},{default:t(()=>[a(w,null,{default:t(()=>[a(H,{class:"d-flex align-center text-h5 bg-green-darken-3 text-white"},{default:t(()=>[a(p,{start:""},{default:t(()=>[...e[35]||(e[35]=[s("mdi-comment-edit-outline",-1)])]),_:1}),e[36]||(e[36]=s(" Analisar Tarefa ",-1)),a(P),a(r,{icon:"mdi-close",variant:"text",onClick:Y})]),_:1}),a(N,{class:"pt-6"},{default:t(()=>[v("p",Ke,c(b.value?.descricao),1),v("p",Xe,c(b.value?.detalhe),1),a(de,{class:"my-6"}),e[38]||(e[38]=v("h3",{class:"text-h6 font-weight-medium mb-4 text-grey-darken-3"},"Histórico de Feedbacks",-1)),!b.value?.feedbacks||b.value?.feedbacks.length===0?(d(),D("div",Ye,[...e[37]||(e[37]=[v("p",null,"Nenhum feedback registrado para esta tarefa ainda.",-1)])])):(d(),g(Fe,{key:1,side:"end",align:"start",density:"compact","truncate-line":"both"},{default:t(()=>[(d(!0),D(W,null,G(b.value?.feedbacks,l=>(d(),g($e,{key:l.id_feedback,"dot-color":"green-darken-1",size:"small"},{default:t(()=>[v("div",Ze,[v("p",ea,'"'+c(l.feedback)+'"',1),v("div",aa," - "+c(l.usuario?.nome||"Orientador")+" em "+c(Ce(l.created_at)),1)])]),_:2},1024))),128))]),_:1})),a(de,{class:"my-6"}),e[39]||(e[39]=v("h3",{class:"text-h6 font-weight-medium mb-4 text-grey-darken-3"},"Adicionar Novo Feedback",-1)),a(ie,{modelValue:A.value,"onUpdate:modelValue":e[12]||(e[12]=l=>A.value=l),label:"Seu parecer sobre a tarefa",placeholder:"Descreva os pontos positivos, áreas para melhoria, ou próximos passos...",rows:"4",variant:"outlined"},null,8,["modelValue"])]),_:1}),a(J,{class:"pa-4"},{default:t(()=>[a(P),a(r,{color:"grey-darken-1",variant:"text",onClick:Y,disabled:q.value},{default:t(()=>[...e[40]||(e[40]=[s("Cancelar",-1)])]),_:1},8,["disabled"]),a(r,{color:"green-darken-2",variant:"flat",onClick:xe,loading:q.value},{default:t(()=>[...e[41]||(e[41]=[s(" Enviar Feedback ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(te,{modelValue:M.value,"onUpdate:modelValue":e[15]||(e[15]=l=>M.value=l),persistent:"","max-width":"500px"},{default:t(()=>[a(w,null,{default:t(()=>[a(H,{class:"text-h5"},{default:t(()=>[a(p,{color:"red",start:""},{default:t(()=>[...e[42]||(e[42]=[s("mdi-alert-circle-outline",-1)])]),_:1}),e[43]||(e[43]=s(" Confirmar Exclusão ",-1))]),_:1}),a(N,null,{default:t(()=>[e[44]||(e[44]=s(" Você tem certeza que deseja apagar a tarefa ",-1)),v("strong",null,'"'+c($.value?.descricao)+'"',1),e[45]||(e[45]=s("? ",-1)),e[46]||(e[46]=v("br",null,null,-1)),e[47]||(e[47]=v("br",null,null,-1)),e[48]||(e[48]=s(" Esta ação não pode ser desfeita. ",-1))]),_:1}),a(J,null,{default:t(()=>[a(P),a(r,{color:"grey-darken-1",variant:"text",onClick:e[14]||(e[14]=l=>M.value=!1)},{default:t(()=>[...e[49]||(e[49]=[s(" Cancelar ",-1)])]),_:1}),a(r,{color:"red-darken-1",variant:"flat",onClick:De},{default:t(()=>[...e[50]||(e[50]=[s(" Apagar Tarefa ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},sa=Ae(ta,[["__scopeId","data-v-6fb0c082"]]);export{sa as default};
