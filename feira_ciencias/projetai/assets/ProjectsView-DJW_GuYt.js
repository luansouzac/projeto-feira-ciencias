import{_ as ue,u as de,s as ce,e as d,m as A,g as ve,l as y,c as P,w as a,r as n,f as pe,o as m,a as t,b as l,d as p,t as O,n as fe,h as R,k as L,F as T,i as G}from"./index-zSKt_z7e.js";import{C as me}from"./CrudModal-paS5u5nx.js";import{u as _e}from"./eventoStore-BIKWor4j.js";import{P as ge}from"./ProjectCard-LQA7CFtH.js";const xe={class:"d-flex align-center"},je={class:"d-flex align-center"},ye={class:"text-h4 font-weight-bold text-grey-darken-4"},ke={class:"d-flex align-center"},be={class:"text-h4 font-weight-bold text-green-darken-4"},Pe={__name:"ProjectsView",setup(Ce){const M=pe(),k=de(),I=_e(),{eventos:J}=ce(I),z=d(!0),$=d(null),c=d([]),C=d("Todos"),H=d("");let w=null;const N=d([]),g=d(0),E=d(!1),x=d(!1),D=()=>({id_evento:null,titulo:"",problema:"",relevancia:"",id_orientador:null,id_coorientador:null}),h=d(D()),S=d(!1),b=d(null),F=sessionStorage.getItem("user_data");if(F){const o=JSON.parse(F);H.value=o.user.nome,w=o.user.id_usuario}const U=A(()=>({title:h.value&&h.value.id_projeto?"Editar Projeto":"Novo Projeto",fields:[{key:"id_evento",label:"Evento Associado",type:"select",items:J.value.map(o=>({title:o.nome,value:o.id_evento})),rules:[o=>!!o||"É necessário selecionar um evento"]},{key:"titulo",label:"Título do Projeto",type:"text",rules:[o=>!!o||"O título é obrigatório"]},{key:"problema",label:"Problema a ser Resolvido",type:"textarea",rules:[o=>!!o||"A descrição do problema é obrigatória"]},{key:"relevancia",label:"Relevância do Projeto",type:"textarea",rules:[o=>!!o||"A relevância é obrigatória"]},{key:"id_orientador",label:"Professor orientador",type:"select",items:N.value.map(o=>({title:o.nome,value:o.id_usuario})),rules:[o=>!!o||"O Orientador é obrigatório"]},{key:"id_coorientador",label:"Professor coorientador",type:"select",items:N.value.map(o=>({title:o.nome,value:o.id_usuario})),rules:[o=>!!o||"O Corientador é obrigatório"]}]})),K=[{title:"Todos",value:"Todos"},{title:"Em Elaboração",value:1},{title:"Reprovado",value:3}];ve(async()=>{if(!w){$.value="Usuário não encontrado. Por favor, faça o login novamente.",z.value=!1;return}const o=y.get(`/projetos?id_responsavel=${w}&situacao_not=2`),e=I.fetchEventos(),s=y.get("/usuarios?id_tipo_usuario=3"),i=y.get(`/projetos?id_responsavel=${w}&id_situacao=2`);try{const v=await Promise.allSettled([o,s,e,i]),[f,j,_,u]=v;f.status==="fulfilled"?c.value=f.value.data:(console.error("Erro ao buscar projetos:",f.reason),c.value=[]),j.status==="fulfilled"?(N.value=j.value.data,console.log("Avaliadores carregados:",N.value)):console.error("Erro ao buscar avaliadores:",j.reason),u.status==="fulfilled"?g.value=u.value.data.length:console.error("Erro ao buscar contagem de aprovados:",u.reason),_.status==="rejected"&&console.error("Erro ao buscar eventos:",_.reason)}catch(v){console.error("Ocorreu um erro inesperado:",v),$.value="Não foi possível carregar os dados da página."}finally{z.value=!1}});const Q=()=>{h.value=D(),E.value=!0},W=o=>{h.value={...o},E.value=!0},X=o=>{b.value=o,S.value=!0},Y=async o=>{x.value=!0;const e=!o.id_projeto;try{if(e){const s={...o,id_responsavel:w,id_situacao:1},{data:i}=await y.post("/projetos",s);c.value.push(i);const{dataEquipe:v}=await y.post("/equipes",{id_projeto:i.id_projeto});k.showSuccess("Projeto criado com sucesso!")}else{const{data:s}=await y.put(`/projetos/${o.id_projeto}`,o),i=c.value.findIndex(v=>v.id_projeto===s.id_projeto);i!==-1&&c.value.splice(i,1,s),k.showSuccess("Projeto alterado com sucesso!")}E.value=!1}catch(s){console.error("Erro ao salvar o projeto:",s),k.showError("Ocorreu um erro ao salvar o projeto.")}finally{x.value=!1}},Z=async()=>{if(b.value){x.value=!0;try{await y.delete(`/projetos/${b.value.id_projeto}`);const o=c.value.findIndex(e=>e.id_projeto===b.value.id_projeto);o!==-1&&c.value.splice(o,1),k.showSuccess("Projeto excluído com sucesso!"),S.value=!1,b.value=null}catch(o){console.error("Erro ao excluir o projeto:",o),k.showError("Ocorreu um erro ao excluir o projeto.")}finally{x.value=!1}}},q=A(()=>C.value==="Todos"||!C.value?c.value:c.value.filter(o=>o.id_situacao===C.value)),ee=A(()=>c.value.length);function oe(o){M.push(`/projetos/${o}`)}function te(){M.push("/projetos/aprovados")}function ae(){g.value>0?te():k.showNotification({message:"É necessário ter um projeto aprovado para acessar esta área.",type:"info"})}return(o,e)=>{const s=n("v-icon"),i=n("v-card-text"),v=n("v-spacer"),f=n("v-btn"),j=n("v-card-actions"),_=n("v-card"),u=n("v-col"),B=n("v-divider"),V=n("v-row"),le=n("v-select"),se=n("v-skeleton-loader"),re=n("v-dialog"),ne=n("v-container");return m(),P(ne,{fluid:""},{default:a(()=>[t(V,{class:"mb-8"},{default:a(()=>[t(u,{cols:"12",sm:"6",md:"4"},{default:a(()=>[t(_,{color:"green-darken-4",dark:"",class:"d-flex flex-column",height:"100%"},{default:a(()=>[t(i,null,{default:a(()=>[l("div",xe,[t(s,{size:"48",class:"mr-4"},{default:a(()=>[...e[4]||(e[4]=[p("mdi-plus-box-multiple",-1)])]),_:1}),e[5]||(e[5]=l("div",null,[l("div",{class:"text-h5 font-weight-bold"},"Novo Projeto"),l("div",{class:"text-subtitle-1"},"Inicie uma nova proposta")],-1))])]),_:1}),t(v),t(j,null,{default:a(()=>[t(f,{variant:"outlined",block:"",onClick:Q},{default:a(()=>[...e[6]||(e[6]=[p("Criar agora",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),t(u,{cols:"12",sm:"6",md:"4"},{default:a(()=>[t(_,{variant:"tonal",color:"grey-darken-1",class:"d-flex flex-column",height:"100%"},{default:a(()=>[t(i,null,{default:a(()=>[l("div",je,[t(s,{size:"48",class:"mr-4"},{default:a(()=>[...e[7]||(e[7]=[p("mdi-folder-account-outline",-1)])]),_:1}),l("div",null,[l("div",ye,O(ee.value),1),e[8]||(e[8]=l("div",{class:"text-subtitle-2 text-grey-darken-2"},"Projetos Registrados",-1))])])]),_:1})]),_:1})]),_:1}),t(u,{cols:"12",sm:"6",md:"4"},{default:a(()=>[t(_,{variant:"tonal",color:"green-darken-2",class:fe(["d-flex flex-column",{"card-clicavel":g.value>0}]),height:"100%",hover:g.value>0,onClick:ae},{default:a(()=>[t(i,{class:"flex-grow-1"},{default:a(()=>[l("div",ke,[t(s,{size:"48",class:"mr-4"},{default:a(()=>[...e[9]||(e[9]=[p("mdi-check-decagram-outline",-1)])]),_:1}),l("div",null,[l("div",be,O(g.value),1),e[10]||(e[10]=l("div",{class:"text-subtitle-2 text-green-darken-3"},"Projetos Aprovados",-1))]),t(v),g.value>0?(m(),P(s,{key:0,size:"36",class:"icon-arrow"},{default:a(()=>[...e[11]||(e[11]=[p("mdi-arrow-right-circle-outline",-1)])]),_:1})):L("",!0)])]),_:1}),g.value>0?(m(),R(T,{key:0},[t(B),t(j,{class:"justify-center text-caption pa-1"},{default:a(()=>[...e[12]||(e[12]=[l("span",{class:"opacity-75"},"Clique para visualizar",-1)])]),_:1})],64)):L("",!0)]),_:1},8,["class","hover"])]),_:1})]),_:1}),t(B,{class:"my-6"}),t(V,{align:"center",class:"mb-4"},{default:a(()=>[t(u,{cols:"12",md:"6"},{default:a(()=>[...e[13]||(e[13]=[l("h2",{class:"text-h5 font-weight-bold text-grey-darken-4"},"Meus Projetos",-1),l("p",{class:"text-subtitle-2 text-grey-darken-1"},"Gerencie e acompanhe o andamento de suas propostas.",-1)])]),_:1}),t(u,{cols:"12",md:"6",class:"d-flex justify-md-end"},{default:a(()=>[t(le,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=r=>C.value=r),items:K,label:"Filtrar por Status",variant:"outlined",density:"compact","hide-details":"",clearable:"",style:{"max-width":"280px"}},null,8,["modelValue"])]),_:1})]),_:1}),z.value?(m(),P(V,{key:0},{default:a(()=>[(m(),R(T,null,G(3,r=>t(u,{key:r,cols:"12",sm:"6",lg:"4"},{default:a(()=>[t(se,{type:"image, article, actions"})]),_:2},1024)),64))]),_:1})):q.value.length===0?(m(),P(V,{key:1},{default:a(()=>[t(u,{cols:"12"},{default:a(()=>[t(_,{flat:"",border:"",class:"text-center pa-8"},{default:a(()=>[t(s,{size:"60",class:"mb-4 text-grey-lighten-1"},{default:a(()=>[...e[14]||(e[14]=[p("mdi-folder-search-outline",-1)])]),_:1}),e[15]||(e[15]=l("p",{class:"text-grey-darken-1"},"Nenhum projeto encontrado.",-1))]),_:1})]),_:1})]),_:1})):(m(),P(V,{key:2},{default:a(()=>[(m(!0),R(T,null,G(q.value,r=>(m(),P(u,{key:r.id_projeto,cols:"12",sm:"6",lg:"4"},{default:a(()=>[t(ge,{projeto:r,onVerDetalhes:oe},{actions:a(()=>[t(f,{icon:"mdi-pencil",variant:"text",size:"small",onClick:ie=>W(r)},null,8,["onClick"]),t(f,{icon:"mdi-delete",variant:"text",color:"grey",size:"small",onClick:ie=>X(r)},null,8,["onClick"])]),_:2},1032,["projeto"])]),_:2},1024))),128))]),_:1})),t(me,{modelValue:E.value,"onUpdate:modelValue":e[1]||(e[1]=r=>E.value=r),title:U.value.title,fields:U.value.fields,item:h.value,loading:x.value,onSave:Y},null,8,["modelValue","title","fields","item","loading"]),t(re,{modelValue:S.value,"onUpdate:modelValue":e[3]||(e[3]=r=>S.value=r),"max-width":"450"},{default:a(()=>[t(_,{"prepend-icon":"mdi-alert-circle-outline",title:"Confirmar Exclusão"},{default:a(()=>[t(i,null,{default:a(()=>[e[16]||(e[16]=p(" Você tem certeza que deseja excluir o projeto ",-1)),l("strong",null,O(b.value?.titulo),1),e[17]||(e[17]=p("? Esta ação não pode ser desfeita. ",-1))]),_:1}),t(j,null,{default:a(()=>[t(v),t(f,{onClick:e[2]||(e[2]=r=>S.value=!1),disabled:x.value},{default:a(()=>[...e[18]||(e[18]=[p("Cancelar",-1)])]),_:1},8,["disabled"]),t(f,{color:"red-darken-2",variant:"flat",onClick:Z,loading:x.value},{default:a(()=>[...e[19]||(e[19]=[p(" Excluir ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},Ve=ue(Pe,[["__scopeId","data-v-18986586"]]);export{Ve as default};
