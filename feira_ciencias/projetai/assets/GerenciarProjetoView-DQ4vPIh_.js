import{u as ne,e as c,g as ie,v as de,l as x,m as U,c as I,w as t,r as a,f as ue,o as f,a as o,h as A,k as ve,p as pe,d as s,b as n,t as p,F as ce,i as me}from"./index-zSKt_z7e.js";const _e={key:0,class:"text-center py-16"},fe={key:2},ge={class:"d-flex flex-wrap justify-space-between align-center"},be={class:"text-h4 font-weight-bold"},xe={class:"d-flex align-center mt-2 opacity-75"},we={class:"text-subtitle-1"},je={class:"text-h3 font-weight-bold"},ye={key:0,class:"text-center text-grey py-8"},ke={class:"text-h6"},Ve={class:"d-none d-sm-block text-caption text-grey-darken-1 mr-4"},Ae={class:"d-flex justify-end"},$e={__name:"GerenciarProjetoView",setup(Ce){const G=de(),R=ue(),u=ne(),l=c(null),m=c(null),_=c([]),C=c(!0),y=c(null),k=c("geral"),P=c(!1),g=c(!1);ie(async()=>{const r=G.params.id;C.value=!0,y.value=null;try{const[e,d]=await Promise.all([x.get(`/projetos/${r}`),x.get(`/membros_projeto/${r}`)]);console.log("Resposta da API para o projeto:",e.data);const w=e.data.data||e.data;if(!w||typeof w!="object")throw new Error("A resposta da API não retornou um formato de projeto válido.");l.value=w,console.log("Resposta da API para os membros:",d.data);const V=d.data.data||d.data;if(_.value=Array.isArray(V)?V:[],l.value.id_evento){const v=await x.get(`/eventos/${l.value.id_evento}`);m.value=v.data.data||v.data}}catch(e){console.error("Erro detalhado ao buscar dados do projeto e da equipe:",e),y.value="Não foi possível carregar os detalhes do projeto. Verifique o console para mais informações."}finally{C.value=!1}});const q={1:{text:"Em Análise",color:"orange-darken-2"},2:{text:"Aprovado",color:"green-darken-2"},5:{text:"Em Desenvolvimento",color:"blue-darken-2"},6:{text:"Concluído",color:"purple-darken-2"}},D=U(()=>l.value?q[l.value.id_situacao]||{text:"Desconhecido",color:"grey"}:{}),L=U(()=>!m.value||!m.value.max_pessoas?0:_.value.length/m.value.max_pessoas*100),O=async()=>{P.value=!0,u.showInfo("Salvando alterações...");try{const r={titulo:l.value.titulo,problema:l.value.problema,relevancia:l.value.relevancia,id_responsavel:l.value.id_responsavel,id_situacao:l.value.id_situacao,id_evento:l.value.id_evento,id_orientador:l.value.id_orientador},e=await x.put(`/projetos/${l.value.id_projeto}`,r);l.value=e.data.data||e.data,u.showSuccess("Projeto atualizado com sucesso!")}catch(r){console.error("Erro ao salvar o projeto:",r);let e="Não foi possível salvar as alterações.";if(r.response?.data?.errors){const d=Object.keys(r.response.data.errors)[0];e=r.response.data.errors[d][0]}else r.response?.data?.erro&&(e=r.response.data.erro);u.showError(e)}finally{P.value=!1}},T=async()=>{u.showInfo("Apagando projeto...");try{await x.delete(`/projetos/${l.value.id_projeto}`),u.showSuccess("Projeto apagado com sucesso!"),g.value=!1,R.push("/banco-projetos")}catch(r){console.error("Erro ao apagar projeto:",r),u.showError(r.response?.data?.erro||"Não foi possível apagar o projeto."),g.value=!1}},F=async r=>{u.showInfo(`Removendo ${r.usuario.nome}...`);try{await x.delete(`/projetos/${l.value.id_projeto}/membros/${r.id_usuario}`),_.value=_.value.filter(e=>e.id_usuario!==r.id_usuario),u.showSuccess(`${r.usuario.nome} foi removido com sucesso!`)}catch(e){console.error("Erro ao remover membro:",e),u.showError(e.response?.data?.erro||"Não foi possível remover o membro.")}},K=r=>r?new Date(r).toLocaleDateString("pt-BR"):"N/A";return(r,e)=>{const d=a("v-btn"),w=a("v-progress-circular"),V=a("v-alert"),v=a("v-icon"),Z=a("v-chip"),H=a("v-card-item"),j=a("v-card"),E=a("v-tab"),J=a("v-tabs"),Q=a("v-progress-linear"),b=a("v-card-text"),S=a("v-col"),$=a("v-list-item"),M=a("v-list"),W=a("v-row"),N=a("v-window-item"),X=a("v-list-subheader"),Y=a("v-avatar"),h=a("v-tooltip"),B=a("v-text-field"),ee=a("v-textarea"),z=a("v-divider"),oe=a("v-window"),te=a("v-card-title"),ae=a("v-spacer"),le=a("v-card-actions"),re=a("v-dialog"),se=a("v-container");return f(),I(se,{fluid:""},{default:t(()=>[o(d,{variant:"text","prepend-icon":"mdi-arrow-left",onClick:e[0]||(e[0]=i=>pe(R).go(-1)),class:"mb-6"},{default:t(()=>[...e[8]||(e[8]=[s(" Voltar ao Banco de Projetos ",-1)])]),_:1}),C.value?(f(),A("div",_e,[o(w,{indeterminate:"",color:"green-darken-3",size:"64"}),e[9]||(e[9]=n("p",{class:"mt-4 text-grey-darken-1"},"Carregando gerenciamento do projeto...",-1))])):y.value?(f(),I(V,{key:1,type:"error",variant:"tonal",prominent:""},{default:t(()=>[s(p(y.value),1)]),_:1})):l.value?(f(),A("div",fe,[o(j,{theme:"dark",class:"mb-8 bg-green-darken-4"},{default:t(()=>[o(H,{class:"pa-4 pa-sm-6"},{default:t(()=>[n("div",ge,[n("div",null,[e[10]||(e[10]=n("p",{class:"text-overline"},"Gerenciamento do Projeto",-1)),n("h1",be,p(l.value.titulo),1),n("div",xe,[o(v,{size:"small",start:"",icon:"mdi-account-tie"}),n("span",we,"Orientador: "+p(l.value.orientador?.nome||"Não definido"),1)])]),o(Z,{color:D.value.color,variant:"tonal",label:""},{default:t(()=>[s(p(D.value.text),1)]),_:1},8,["color"])])]),_:1})]),_:1}),o(j,null,{default:t(()=>[o(J,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=i=>k.value=i),"bg-color":"green-darken-3",color:"white",grow:""},{default:t(()=>[o(E,{value:"geral"},{default:t(()=>[o(v,{start:""},{default:t(()=>[...e[11]||(e[11]=[s("mdi-information-outline",-1)])]),_:1}),e[12]||(e[12]=s("Visão Geral",-1))]),_:1}),o(E,{value:"membros"},{default:t(()=>[o(v,{start:""},{default:t(()=>[...e[13]||(e[13]=[s("mdi-account-group-outline",-1)])]),_:1}),e[14]||(e[14]=s("Membros Inscritos",-1))]),_:1}),o(E,{value:"configuracoes"},{default:t(()=>[o(v,{start:""},{default:t(()=>[...e[15]||(e[15]=[s("mdi-cog-outline",-1)])]),_:1}),e[16]||(e[16]=s("Configurações",-1))]),_:1})]),_:1},8,["modelValue"]),o(oe,{modelValue:k.value,"onUpdate:modelValue":e[5]||(e[5]=i=>k.value=i)},{default:t(()=>[o(N,{value:"geral"},{default:t(()=>[o(b,{class:"pa-4 pa-md-6"},{default:t(()=>[o(W,null,{default:t(()=>[o(S,{cols:"12",md:"4"},{default:t(()=>[o(j,{variant:"tonal",color:"blue-grey"},{default:t(()=>[o(b,null,{default:t(()=>[n("div",je,p(_.value.length)+" / "+p(m.value?.max_pessoas||l.value.max_membros),1),e[17]||(e[17]=n("div",{class:"text-subtitle-1"},"Inscrições",-1)),o(Q,{"model-value":L.value,color:"light-blue",height:"6",rounded:"",class:"mt-2"},null,8,["model-value"])]),_:1})]),_:1})]),_:1}),o(S,{cols:"12",md:"8"},{default:t(()=>[o(M,{lines:"two","bg-color":"transparent"},{default:t(()=>[o($,{"prepend-icon":"mdi-text-box-outline",title:"Descrição do Projeto",subtitle:l.value.problema},null,8,["subtitle"]),o($,{"prepend-icon":"mdi-bullseye-arrow",title:"Relevância",subtitle:l.value.relevancia},null,8,["subtitle"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(N,{value:"membros"},{default:t(()=>[o(b,{class:"pa-0"},{default:t(()=>[o(M,{lines:"two"},{default:t(()=>[o(X,null,{default:t(()=>[...e[18]||(e[18]=[s("Alunos inscritos no projeto",-1)])]),_:1}),_.value.length===0?(f(),A("div",ye," Nenhum aluno inscrito até o momento. ")):(f(!0),A(ce,{key:1},me(_.value,i=>(f(),I($,{key:i.id_usuario,title:i.usuario.nome,subtitle:i.usuario.email},{prepend:t(()=>[o(Y,{color:"green-darken-4"},{default:t(()=>[n("span",ke,p(i.usuario.nome.charAt(0)),1)]),_:2},1024)]),append:t(()=>[n("div",Ve,"Inscrito em: "+p(K(i.created_at)),1),o(d,{color:"red-lighten-1",variant:"text",icon:"mdi-account-remove-outline",onClick:Pe=>F(i)},{default:t(()=>[o(v),o(h,{activator:"parent",location:"bottom"},{default:t(()=>[...e[19]||(e[19]=[s("Remover Aluno",-1)])]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["title","subtitle"]))),128))]),_:1})]),_:1})]),_:1}),o(N,{value:"configuracoes"},{default:t(()=>[o(b,{class:"pa-4 pa-md-6"},{default:t(()=>[e[23]||(e[23]=n("h3",{class:"text-h6 mb-6"},"Configurações Gerais",-1)),o(B,{modelValue:l.value.titulo,"onUpdate:modelValue":e[2]||(e[2]=i=>l.value.titulo=i),label:"Título do Projeto",variant:"outlined",class:"mb-4"},null,8,["modelValue"]),o(ee,{modelValue:l.value.problema,"onUpdate:modelValue":e[3]||(e[3]=i=>l.value.problema=i),label:"Descrição do Problema",variant:"outlined",rows:"3",class:"mb-4"},null,8,["modelValue"]),o(B,{"model-value":m.value?.max_pessoas,label:"Número Máximo de Alunos",variant:"outlined",class:"mb-4",style:{"max-width":"350px"},disabled:"",readonly:"",hint:`Limite definido pelo evento: ${m.value?.nome}`,"persistent-hint":""},null,8,["model-value","hint"]),o(z,{class:"my-6"}),n("div",Ae,[o(d,{size:"large",color:"green-darken-3",onClick:O,loading:P.value},{default:t(()=>[...e[20]||(e[20]=[s("Salvar Alterações",-1)])]),_:1},8,["loading"])]),o(z,{class:"my-8"}),e[24]||(e[24]=n("h3",{class:"text-h6 mb-4 text-red-darken-2"},"Zona de Perigo",-1)),o(j,{variant:"outlined",color:"red"},{default:t(()=>[o(b,{class:"d-flex justify-space-between align-center"},{default:t(()=>[e[22]||(e[22]=n("div",null,[n("div",{class:"font-weight-bold"},"Apagar este projeto"),n("div",{class:"text-caption"},"Esta ação é permanente e removerá o projeto do sistema.")],-1)),o(d,{color:"red-darken-2",variant:"flat",onClick:e[4]||(e[4]=i=>g.value=!0)},{default:t(()=>[...e[21]||(e[21]=[s("Apagar",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})])):ve("",!0),o(re,{modelValue:g.value,"onUpdate:modelValue":e[7]||(e[7]=i=>g.value=i),persistent:"","max-width":"500px"},{default:t(()=>[o(j,null,{default:t(()=>[o(te,{class:"text-h5"},{default:t(()=>[o(v,{color:"red",start:""},{default:t(()=>[...e[25]||(e[25]=[s("mdi-alert-circle-outline",-1)])]),_:1}),e[26]||(e[26]=s(" Confirmar Exclusão ",-1))]),_:1}),o(b,null,{default:t(()=>[e[27]||(e[27]=s(" Você tem certeza que deseja apagar o projeto ",-1)),n("strong",null,'"'+p(l.value?.titulo)+'"',1),e[28]||(e[28]=s("? ",-1)),e[29]||(e[29]=n("br",null,null,-1)),e[30]||(e[30]=n("br",null,null,-1)),e[31]||(e[31]=s(" Esta ação não pode ser desfeita. ",-1))]),_:1}),o(le,null,{default:t(()=>[o(ae),o(d,{color:"grey-darken-1",variant:"text",onClick:e[6]||(e[6]=i=>g.value=!1)},{default:t(()=>[...e[32]||(e[32]=[s(" Cancelar ",-1)])]),_:1}),o(d,{color:"red-darken-1",variant:"flat",onClick:T},{default:t(()=>[...e[33]||(e[33]=[s(" Apagar Projeto ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{$e as default};
