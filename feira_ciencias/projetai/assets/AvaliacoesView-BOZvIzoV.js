import{_ as se,u as re,e as m,m as ne,g as ie,c as k,w as t,f as de,l as I,r as s,o as v,a as o,b as a,d as l,t as d,n as J,h as T,k as L,F as q,i as U,y as ue}from"./index-zSKt_z7e.js";const ce={class:"d-flex align-center"},ve={class:"text-h4 font-weight-bold"},pe={class:"d-flex align-center"},fe={class:"text-h4 font-weight-bold"},me={class:"d-flex justify-space-between align-start mb-1"},_e={class:"text-body-2 text-grey-darken-2 mb-4 text-truncate-3-lines"},ge={class:"d-flex align-center"},xe={class:"text-body-2 font-weight-medium text-truncate"},ke={class:"d-flex align-center"},ye={class:"text-body-2 font-weight-medium text-truncate"},be={__name:"AvaliacoesView",setup(we){const P=de(),y=re(),N=m(!0),g=m([]),p=m(0);let O=null;const j=m(!1),D=m(!1),b=m(null),u=m(""),w=m(""),B={1:{text:"Submetido",color:"blue"},2:{text:"Aprovado",color:"green"},3:{text:"Reprovado",color:"red"},4:{text:"Ressalvas",color:"orange"},5:{text:"Em Desenvolvimento",color:"teal"},6:{text:"Concluído",color:"purple"}},R=ne(()=>{switch(u.value){case"aprovado":return{title:"Aprovar Projeto",color:"green-darken-2"};case"ressalva":return{title:"Reprovar com Ressalvas",color:"orange-darken-2"};case"reprovado":return{title:"Reprovar Projeto",color:"red-darken-2"};default:return{title:"Confirmar Ação",color:"grey"}}});ie(async()=>{N.value=!0;try{const i=sessionStorage.getItem("user_data");if(!i){P.push({name:"login"});return}O=JSON.parse(i).user.id_usuario;const _=(await I.get(`/usuarios/${O}/projetos/avaliacao`)).data;g.value=_.filter(c=>c.id_situacao===1),p.value=_.filter(c=>c.id_situacao===2).length}catch(i){console.error("Erro ao buscar dados dos projetos:",i),y.showNotification({message:"Falha ao carregar dados da página.",type:"error"})}finally{N.value=!1}});function G(i){P.push(`/projetos/${i}`)}const M=(i,e)=>{b.value=i,u.value=e,w.value="",j.value=!0},E=()=>{j.value=!1,D.value=!1,setTimeout(()=>{b.value=null,u.value=""},300)},H=async()=>{if((u.value==="ressalva"||u.value==="reprovado")&&!w.value.trim()){y.showNotification({message:"A justificativa é obrigatória para esta ação.",type:"warning"});return}D.value=!0;const e={id_situacao:{aprovado:2,reprovado:3,ressalva:4}[u.value],id_projeto:b.value.id_projeto,id_avaliador:O,feedback:w.value};try{await I.post("projeto_avaliacoes",e),g.value=g.value.filter(n=>n.id_projeto!==b.value.id_projeto),u.value==="aprovado"&&p.value++,y.showNotification({message:"Projeto avaliado com sucesso!",type:"success"})}catch(n){console.error("Erro ao confirmar avaliação:",n),y.showNotification({message:"Ocorreu um erro ao salvar a avaliação.",type:"error"})}finally{E()}};function K(){P.push("/projetos/orientados")}function Q(){p.value>0?K():y.showNotification({message:"Você não possui projetos aprovados para gerenciar no momento.",type:"info"})}return(i,e)=>{const n=s("v-icon"),_=s("v-card-text"),c=s("v-card"),f=s("v-col"),A=s("v-spacer"),S=s("v-divider"),z=s("v-card-actions"),x=s("v-row"),W=s("v-skeleton-loader"),F=s("v-card-title"),X=s("v-chip"),Y=s("v-card-subtitle"),Z=s("v-card-item"),V=s("v-btn"),$=s("v-list-item-title"),h=s("v-list-item"),ee=s("v-list"),te=s("v-menu"),oe=s("v-textarea"),ae=s("v-dialog"),le=s("v-container");return v(),k(le,{fluid:""},{default:t(()=>[o(x,{class:"mb-8"},{default:t(()=>[o(f,{cols:"12",sm:"6",md:"4"},{default:t(()=>[o(c,{color:"green-darken-4",dark:"",class:"d-flex flex-column",height:"100%"},{default:t(()=>[o(_,null,{default:t(()=>[a("div",ce,[o(n,{size:"48",class:"mr-4"},{default:t(()=>[...e[2]||(e[2]=[l("mdi-clipboard-list-outline",-1)])]),_:1}),a("div",null,[a("div",ve,d(g.value.length),1),e[3]||(e[3]=a("div",{class:"text-subtitle-1"},"Avaliações Pendentes",-1))])])]),_:1})]),_:1})]),_:1}),o(f,{cols:"12",sm:"6",md:"4"},{default:t(()=>[o(c,{color:"green-darken-4",class:J(["d-flex flex-column text-white",{"card-clicavel":p.value>0}]),height:"100%",hover:p.value>0,onClick:Q,variant:"tonal"},{default:t(()=>[o(_,{class:"flex-grow-1"},{default:t(()=>[a("div",pe,[o(n,{size:"48",class:"mr-4"},{default:t(()=>[...e[4]||(e[4]=[l("mdi-school-outline",-1)])]),_:1}),a("div",null,[a("div",fe,d(p.value),1),e[5]||(e[5]=a("div",{class:"text-subtitle-1"},"Projetos Orientados",-1))]),o(A),p.value>0?(v(),k(n,{key:0,size:"36",class:"icon-arrow"},{default:t(()=>[...e[6]||(e[6]=[l("mdi-arrow-right-circle-outline",-1)])]),_:1})):L("",!0)])]),_:1}),p.value>0?(v(),T(q,{key:0},[o(S),o(z,{class:"justify-center text-caption pa-1"},{default:t(()=>[...e[7]||(e[7]=[a("span",{class:"opacity-75"},"Clique para gerenciar",-1)])]),_:1})],64)):L("",!0)]),_:1},8,["class","hover"])]),_:1})]),_:1}),o(S,{class:"my-6"}),o(x,{align:"center",class:"mb-4"},{default:t(()=>[o(f,{cols:"12"},{default:t(()=>[...e[8]||(e[8]=[a("h2",{class:"text-h5 font-weight-bold text-grey-darken-4"},"Projetos para Avaliação",-1),a("p",{class:"text-subtitle-2 text-grey-darken-1"}," Analise e forneça seu parecer sobre as propostas de projeto. ",-1)])]),_:1})]),_:1}),N.value?(v(),k(x,{key:0},{default:t(()=>[(v(),T(q,null,U(3,r=>o(f,{key:r,cols:"12",sm:"6",lg:"4"},{default:t(()=>[o(W,{type:"card"})]),_:2},1024)),64))]),_:1})):g.value.length===0?(v(),k(x,{key:1},{default:t(()=>[o(f,{cols:"12"},{default:t(()=>[o(c,{flat:"",border:"",class:"text-center pa-8"},{default:t(()=>[o(n,{size:"60",class:"mb-4 text-grey-lighten-1"},{default:t(()=>[...e[9]||(e[9]=[l("mdi-check-all",-1)])]),_:1}),e[10]||(e[10]=a("p",{class:"text-h6 text-grey-darken-2"},"Tudo certo por aqui!",-1)),e[11]||(e[11]=a("p",{class:"text-grey-darken-1"},"Nenhuma avaliação pendente no momento.",-1))]),_:1})]),_:1})]),_:1})):(v(),k(x,{key:2},{default:t(()=>[(v(!0),T(q,null,U(g.value,r=>(v(),k(f,{key:r.id_projeto,cols:"12",sm:"6",lg:"4"},{default:t(()=>[o(c,{class:"d-flex flex-column",height:"100%",hover:"",variant:"outlined"},{default:t(()=>[o(Z,{class:"pb-2"},{default:t(()=>[a("div",me,[o(F,{class:"text-wrap me-2"},{default:t(()=>[l(d(r.titulo),1)]),_:2},1024),o(X,{color:B[r.id_situacao]?.color||"grey",size:"small",label:""},{default:t(()=>[l(d(B[r.id_situacao]?.text||"Pendente"),1)]),_:2},1032,["color"])]),o(Y,{class:"d-flex align-center"},{default:t(()=>[o(n,{start:"",size:"small"},{default:t(()=>[...e[12]||(e[12]=[l("mdi-calendar-star",-1)])]),_:1}),l(" "+d(r.eventos.nome),1)]),_:2},1024)]),_:2},1024),o(_,{class:"py-3"},{default:t(()=>[a("p",_e,d(r.problema),1),o(x,{dense:""},{default:t(()=>[o(f,{cols:"12",sm:"6"},{default:t(()=>[a("div",ge,[o(n,{start:"",color:"grey-darken-1"},{default:t(()=>[...e[13]||(e[13]=[l("mdi-account-school-outline",-1)])]),_:1}),a("div",null,[e[14]||(e[14]=a("div",{class:"text-caption text-grey-darken-1"},"Responsável",-1)),a("div",xe,d(r.responsavel.nome),1)])])]),_:2},1024),o(f,{cols:"12",sm:"6"},{default:t(()=>[a("div",ke,[o(n,{start:"",color:"grey-darken-1"},{default:t(()=>[...e[15]||(e[15]=[l("mdi-account-tie-outline",-1)])]),_:1}),a("div",null,[e[16]||(e[16]=a("div",{class:"text-caption text-grey-darken-1"},"Orientador",-1)),a("div",ye,d(r.orientador.nome),1)])])]),_:2},1024)]),_:2},1024)]),_:2},1024),o(A),o(S),o(z,null,{default:t(()=>[o(V,{color:"grey-darken-1",variant:"text",onClick:C=>G(r.id_projeto)},{default:t(()=>[...e[17]||(e[17]=[l("Ver Detalhes",-1)])]),_:2},1032,["onClick"]),o(A),o(te,{"offset-y":""},{activator:t(({props:C})=>[o(V,ue({color:"blue-darken-2",variant:"tonal"},{ref_for:!0},C),{default:t(()=>[e[19]||(e[19]=l(" Avaliar ",-1)),o(n,{right:"",dark:""},{default:t(()=>[...e[18]||(e[18]=[l("mdi-chevron-down",-1)])]),_:1})]),_:2},1040)]),default:t(()=>[o(ee,{density:"compact"},{default:t(()=>[o(h,{onClick:C=>M(r,"aprovado")},{prepend:t(()=>[o(n,{color:"green"},{default:t(()=>[...e[20]||(e[20]=[l("mdi-check-circle-outline",-1)])]),_:1})]),default:t(()=>[o($,null,{default:t(()=>[...e[21]||(e[21]=[l("Aprovar",-1)])]),_:1})]),_:2},1032,["onClick"]),o(h,{onClick:C=>M(r,"ressalva")},{prepend:t(()=>[o(n,{color:"orange"},{default:t(()=>[...e[22]||(e[22]=[l("mdi-alert-circle-outline",-1)])]),_:1})]),default:t(()=>[o($,null,{default:t(()=>[...e[23]||(e[23]=[l("Reprovar com Ressalvas",-1)])]),_:1})]),_:2},1032,["onClick"]),o(h,{onClick:C=>M(r,"reprovado")},{prepend:t(()=>[o(n,{color:"red"},{default:t(()=>[...e[24]||(e[24]=[l("mdi-close-circle-outline",-1)])]),_:1})]),default:t(()=>[o($,null,{default:t(()=>[...e[25]||(e[25]=[l("Reprovar",-1)])]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})),o(ae,{modelValue:j.value,"onUpdate:modelValue":e[1]||(e[1]=r=>j.value=r),persistent:"","max-width":"500px"},{default:t(()=>[o(c,null,{default:t(()=>[o(F,{class:J(["text-h5","text-white",R.value.color])},{default:t(()=>[l(d(R.value.title),1)]),_:1},8,["class"]),o(_,{class:"pt-4"},{default:t(()=>[e[26]||(e[26]=l(" Você está prestes a avaliar o projeto ",-1)),a("strong",null,'"'+d(b.value?.titulo)+'"',1),e[27]||(e[27]=l(". ",-1)),o(oe,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=r=>w.value=r),label:u.value==="aprovado"?"Feedback (Opcional)":"Justificativa (Obrigatório)",placeholder:"Descreva seu parecer sobre o projeto...",rows:"4",class:"mt-4",variant:"outlined",required:u.value!=="aprovado",autofocus:""},null,8,["modelValue","label","required"])]),_:1}),o(z,null,{default:t(()=>[o(A),o(V,{color:"grey-darken-1",variant:"text",onClick:E},{default:t(()=>[...e[28]||(e[28]=[l("Cancelar",-1)])]),_:1}),o(V,{color:R.value.color,variant:"tonal",onClick:H,loading:D.value},{default:t(()=>[...e[29]||(e[29]=[l(" Confirmar ",-1)])]),_:1},8,["color","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},Ae=se(be,[["__scopeId","data-v-3fc29f9e"]]);export{Ae as default};
