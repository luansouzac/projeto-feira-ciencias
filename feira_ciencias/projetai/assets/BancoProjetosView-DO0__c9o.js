import{_ as pe,u as ye,s as be,e as p,g as ke,l as z,m as G,c as v,w as s,r as i,f as xe,o as r,a,h as m,k as P,b as n,t as u,d as l,F as k,i as S,n as we}from"./index-zSKt_z7e.js";import{C as Ce}from"./CrudModal-paS5u5nx.js";import{u as Ve}from"./eventoStore-BIKWor4j.js";const he={class:"text-h4 font-weight-bold text-green-darken-4"},Ee={class:"text-subtitle-1 text-grey-darken-2"},Ae={key:0},Ie={key:2},ze={key:1},Pe={class:"d-flex justify-space-between align-start"},Se={class:"info-item"},Ne={class:"font-weight-medium text-body-2"},$e={class:"info-item mt-1"},Be={class:"text-body-2"},Oe={class:"mt-4"},De={class:"d-flex justify-space-between align-center mb-1"},Te={class:"font-weight-bold"},Me={class:"text-caption text-grey-darken-1"},Re={class:"d-none d-md-table-cell"},Le={class:"d-flex align-center",style:{"min-width":"150px"}},qe={class:"font-weight-medium text-body-2"},Fe={class:"d-none d-sm-table-cell"},Ge={class:"text-right"},Ue={key:0},Je={key:1},He={__name:"BancoProjetosView",setup(Ke){const U=xe(),x=ye(),J=Ve(),{eventos:ae}=be(J),N=p([]),$=p(!0),V=p(null),B=p(""),h=p("Todos"),E=p("grid"),O=p([]);let D=null;const _=p(null),A=p(!1),T=p(!1),H=()=>({id_evento:null,titulo:"",problema:"",relevancia:"",id_orientador:null,id_coorientador:null}),K=p(H()),Q=sessionStorage.getItem("user_data");if(Q){const t=JSON.parse(Q);D=t.user.id_usuario,_.value=t.user.id_tipo_usuario}ke(async()=>{$.value=!0,V.value=null;const t=z.get("/projetos"),e=z.get("/usuarios?id_tipo_usuario=3"),d=J.fetchEventos();try{const c=await Promise.allSettled([t,e,d]),[f,b,y]=c;if(f.status==="fulfilled"){let w=f.value.data;_.value===2&&(w=w.filter(g=>g.id_situacao>1)),N.value=w.map(X)}else throw console.error("Erro ao buscar projetos:",f.reason),new Error("Não foi possível carregar os projetos.");b.status==="fulfilled"?O.value=b.value.data:console.error("Erro ao buscar avaliadores:",b.reason),y.status==="rejected"&&console.error("Erro ao buscar eventos:",y.reason)}catch(c){V.value=c.message||"Ocorreu um erro inesperado."}finally{$.value=!1}});const W=G(()=>({title:"Cadastrar Novo Projeto",fields:[{key:"id_evento",label:"Evento Associado",type:"select",items:ae.value.map(t=>({title:t.nome,value:t.id_evento})),rules:[t=>!!t||"É necessário selecionar um evento"]},{key:"titulo",label:"Título do Projeto",type:"text",rules:[t=>!!t||"O título é obrigatório"]},{key:"problema",label:"Problema a ser Resolvido",type:"textarea",rules:[t=>!!t||"A descrição do problema é obrigatória"]},{key:"relevancia",label:"Relevância do Projeto",type:"textarea",rules:[t=>!!t||"A relevância é obrigatória"]},{key:"id_orientador",label:"Professor Orientador",type:"select",items:O.value.map(t=>({title:t.nome,value:t.id_usuario})),rules:[t=>!!t||"O orientador é obrigatório"]},{key:"id_coorientador",label:"Professor Coorientador (Opcional)",type:"select",items:O.value.map(t=>({title:t.nome,value:t.id_usuario}))}]})),X=t=>{const e=t.equipe?.[0]?.membro_equipe?.length??0,d=t.eventos?.max_pessoas||t.max_membros||5;let c="Em Análise",f=!1;t.id_situacao>1&&(f=!0,c=e>=d?"Esgotado":"Vagas Abertas");const b=t.equipe?.[0]?.membro_equipe?.some(y=>y.id_usuario===D)??!1;return{id:t.id_projeto,titulo:t.titulo,orientador:t.orientador?.nome||"Não definido",area:t.area_conhecimento||"Não definida",status:c,validado:f,inscritos:e,maxAlunos:d,alunoInscrito:b}},Y={"Vagas Abertas":{color:"green-darken-2"},Esgotado:{color:"red-darken-2"},"Em Análise":{color:"orange-darken-2"}},le=G(()=>_.value===2?["Todos","Vagas Abertas","Esgotado"]:["Todos","Vagas Abertas","Esgotado","Em Análise"]),M=G(()=>N.value.filter(t=>{const e=t.titulo.toLowerCase().includes(B.value.toLowerCase()),d=h.value==="Todos"||t.status===h.value;return e&&d})),R=(t,e)=>e>0?t/e*100:0,L=(t,e)=>{const d=R(t,e);return d>=100?"red-darken-1":d>70?"orange-darken-1":"green-darken-1"},ne=()=>{K.value=H(),A.value=!0},re=async t=>{T.value=!0;try{const e={...t,id_responsavel:D,id_situacao:2},{data:d}=await z.post("/projetos",e);N.value.unshift(X(d)),x.showSuccess("Projeto cadastrado com sucesso!"),A.value=!1}catch(e){console.error("Erro ao cadastrar o projeto:",e),x.showError("Ocorreu um erro ao cadastrar o projeto.")}finally{T.value=!1}},Z=t=>{U.push(`/gerenciar-projeto/${t}`)},j=t=>{U.push(`/projetos/${t}`)},ee=async t=>{x.showInfo(`Enviando inscrição para "${t.titulo}"...`);try{await z.post(`/projetos/${t.id}/inscrever`),x.showSuccess("Inscrição realizada com sucesso!"),t.alunoInscrito=!0,t.inscritos++,t.inscritos>=t.maxAlunos&&(t.status="Esgotado")}catch(e){console.error("Erro ao inscrever no projeto:",e);const d=e.response?.data?.erro||"Não foi possível realizar a inscrição.";x.showError(d)}};return(t,e)=>{const d=i("v-col"),c=i("v-btn"),f=i("v-row"),b=i("v-text-field"),y=i("v-chip"),w=i("v-chip-group"),g=i("v-icon"),te=i("v-tooltip"),ie=i("v-btn-toggle"),q=i("v-card"),de=i("v-skeleton-loader"),oe=i("v-alert"),ue=i("v-card-title"),I=i("v-card-subtitle"),ce=i("v-card-item"),se=i("v-progress-linear"),ve=i("v-card-text"),F=i("v-spacer"),me=i("v-divider"),_e=i("v-card-actions"),fe=i("v-table"),ge=i("v-container");return r(),v(ge,{fluid:""},{default:s(()=>[a(f,{class:"mb-6",align:"center"},{default:s(()=>[a(d,{cols:"12",md:"8"},{default:s(()=>[n("h1",he,u(_.value===2?"Projetos Disponíveis":"Banco de Projetos"),1),n("p",Ee,u(_.value===2?"Explore os temas e inscreva-se em um projeto.":"Visualize, gerencie e cadastre novas propostas."),1)]),_:1}),_.value!==2?(r(),v(d,{key:0,cols:"12",md:"4",class:"text-md-right"},{default:s(()=>[a(c,{color:"green-darken-3",size:"large","prepend-icon":"mdi-plus-box-outline",onClick:ne,block:""},{default:s(()=>[...e[4]||(e[4]=[l(" Cadastrar Novo Projeto ",-1)])]),_:1})]),_:1})):P("",!0)]),_:1}),a(q,{class:"mb-8 pa-4",variant:"outlined"},{default:s(()=>[a(f,{align:"center"},{default:s(()=>[a(d,{cols:"12",md:"6"},{default:s(()=>[a(b,{modelValue:B.value,"onUpdate:modelValue":e[0]||(e[0]=o=>B.value=o),label:"Buscar por título do projeto...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),a(d,{cols:"12",md:"6",class:"d-flex align-center justify-start justify-md-end"},{default:s(()=>[a(w,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=o=>h.value=o),mandatory:"",color:"green-darken-3"},{default:s(()=>[(r(!0),m(k,null,S(le.value,o=>(r(),v(y,{key:o,value:o,filter:""},{default:s(()=>[l(u(o),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),a(ie,{modelValue:E.value,"onUpdate:modelValue":e[2]||(e[2]=o=>E.value=o),mandatory:"",density:"compact",variant:"outlined",class:"ml-4"},{default:s(()=>[a(c,{value:"grid","aria-label":"Visualização em Grade"},{default:s(()=>[a(g,null,{default:s(()=>[...e[5]||(e[5]=[l("mdi-view-grid-outline",-1)])]),_:1}),a(te,{activator:"parent",location:"bottom"},{default:s(()=>[...e[6]||(e[6]=[l("Grade",-1)])]),_:1})]),_:1}),a(c,{value:"list","aria-label":"Visualização em Lista"},{default:s(()=>[a(g,null,{default:s(()=>[...e[7]||(e[7]=[l("mdi-view-list-outline",-1)])]),_:1}),a(te,{activator:"parent",location:"bottom"},{default:s(()=>[...e[8]||(e[8]=[l("Lista",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),$.value?(r(),m("div",Ae,[a(f,null,{default:s(()=>[(r(),m(k,null,S(6,o=>a(d,{key:o,cols:"12",sm:"6",lg:"4"},{default:s(()=>[a(de,{type:"card"})]),_:2},1024)),64))]),_:1})])):V.value?(r(),v(oe,{key:1,type:"error",variant:"tonal",border:"start",prominent:""},{default:s(()=>[l(u(V.value),1)]),_:1})):(r(),m("div",Ie,[M.value.length===0?(r(),v(oe,{key:0,type:"info",variant:"tonal",border:"start",prominent:""},{default:s(()=>[...e[9]||(e[9]=[l(" Nenhum projeto encontrado com os filtros selecionados. ",-1)])]),_:1})):(r(),m("div",ze,[E.value==="grid"?(r(),v(f,{key:0},{default:s(()=>[(r(!0),m(k,null,S(M.value,o=>(r(),v(d,{key:o.id,cols:"12",sm:"6",lg:"4"},{default:s(()=>[a(q,{class:"d-flex flex-column",height:"100%",hover:"",variant:"outlined"},{default:s(()=>[a(ce,{class:"pb-2"},{default:s(()=>[n("div",Pe,[a(ue,{class:"text-wrap me-2"},{default:s(()=>[l(u(o.titulo),1)]),_:2},1024),a(y,{color:Y[o.status].color,size:"small",label:"",variant:"tonal"},{default:s(()=>[l(u(o.status),1)]),_:2},1032,["color"])]),_.value!==2&&!o.validado?(r(),v(I,{key:0,class:"d-flex align-center text-orange-darken-3 mt-1"},{default:s(()=>[a(g,{size:"xs",start:""},{default:s(()=>[...e[10]||(e[10]=[l("mdi-eye-off-outline",-1)])]),_:1}),e[11]||(e[11]=l(" Visível apenas para professores ",-1))]),_:1})):(r(),v(I,{key:1,class:"d-flex align-center text-green-darken-3 mt-1"},{default:s(()=>[a(g,{size:"xs",start:""},{default:s(()=>[...e[12]||(e[12]=[l("mdi-eye-outline",-1)])]),_:1}),e[13]||(e[13]=l(" Público para inscrições ",-1))]),_:1}))]),_:2},1024),a(ve,{class:"py-3"},{default:s(()=>[n("div",null,[n("div",Se,[a(g,{start:"",color:"grey-darken-1",size:"small"},{default:s(()=>[...e[14]||(e[14]=[l("mdi-account-tie",-1)])]),_:1}),n("span",Ne,u(o.orientador),1)]),n("div",$e,[a(g,{start:"",color:"grey-darken-1",size:"small"},{default:s(()=>[...e[15]||(e[15]=[l("mdi-lightbulb-on-outline",-1)])]),_:1}),n("span",Be,u(o.area),1)])]),n("div",Oe,[n("div",De,[e[16]||(e[16]=n("span",{class:"text-body-2 font-weight-medium text-grey-darken-3"},"Inscrições",-1)),n("span",{class:we(["font-weight-bold",`text-${L(o.inscritos,o.maxAlunos)}`])},u(o.inscritos)+" / "+u(o.maxAlunos),3)]),a(se,{"model-value":R(o.inscritos,o.maxAlunos),color:L(o.inscritos,o.maxAlunos),height:"7",rounded:""},null,8,["model-value","color"])])]),_:2},1024),a(F),a(me),a(_e,{class:"pa-2"},{default:s(()=>[_.value!==2?(r(),m(k,{key:0},[a(F),a(c,{color:"green-darken-3",variant:"text",onClick:C=>Z(o.id)},{default:s(()=>[e[18]||(e[18]=l("Gerenciar",-1)),a(g,{end:""},{default:s(()=>[...e[17]||(e[17]=[l("mdi-arrow-right",-1)])]),_:1})]),_:2},1032,["onClick"])],64)):(r(),m(k,{key:1},[a(c,{variant:"text",onClick:C=>j(o.id)},{default:s(()=>[...e[19]||(e[19]=[l("Ver Detalhes",-1)])]),_:2},1032,["onClick"]),a(F),a(c,{disabled:o.status==="Esgotado"||o.alunoInscrito,color:"green-darken-3",variant:"flat",onClick:C=>ee(o)},{default:s(()=>[l(u(o.alunoInscrito?"Inscrito":"Inscrever-se"),1)]),_:2},1032,["disabled","onClick"])],64))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):P("",!0),E.value==="list"?(r(),v(q,{key:1,variant:"outlined"},{default:s(()=>[a(fe,{hover:""},{default:s(()=>[e[26]||(e[26]=n("thead",null,[n("tr",null,[n("th",{class:"text-left"},"Projeto"),n("th",{class:"text-left d-none d-md-table-cell"},"Inscrições"),n("th",{class:"text-left d-none d-sm-table-cell"},"Status"),n("th",{class:"text-right"},"Ações")])],-1)),n("tbody",null,[(r(!0),m(k,null,S(M.value,o=>(r(),m("tr",{key:`list-${o.id}`},[n("td",null,[n("div",Te,u(o.titulo),1),n("div",Me,u(o.orientador),1),_.value!==2&&!o.validado?(r(),v(I,{key:0,class:"d-flex align-center text-orange-darken-3 pa-0 mt-1",style:{"font-size":"0.7rem"}},{default:s(()=>[a(g,{size:"xs",start:""},{default:s(()=>[...e[20]||(e[20]=[l("mdi-eye-off-outline",-1)])]),_:1}),e[21]||(e[21]=l("Apenas professores",-1))]),_:1})):(r(),v(I,{key:1,class:"d-flex align-center text-green-darken-3 pa-0 mt-1",style:{"font-size":"0.7rem"}},{default:s(()=>[a(g,{size:"xs",start:""},{default:s(()=>[...e[22]||(e[22]=[l("mdi-eye-outline",-1)])]),_:1}),e[23]||(e[23]=l("Público",-1))]),_:1}))]),n("td",Re,[n("div",Le,[a(se,{"model-value":R(o.inscritos,o.maxAlunos),color:L(o.inscritos,o.maxAlunos),height:"6",rounded:"",class:"mr-3"},null,8,["model-value","color"]),n("span",qe,u(o.inscritos)+"/"+u(o.maxAlunos),1)])]),n("td",Fe,[a(y,{color:Y[o.status].color,size:"small",label:"",variant:"tonal"},{default:s(()=>[l(u(o.status),1)]),_:2},1032,["color"])]),n("td",Ge,[_.value!==2?(r(),m("div",Ue,[a(c,{color:"grey-darken-2",variant:"text",onClick:C=>Z(o.id)},{default:s(()=>[...e[24]||(e[24]=[l("Gerenciar",-1)])]),_:2},1032,["onClick"])])):(r(),m("div",Je,[a(c,{size:"small",variant:"text",onClick:C=>j(o.id),class:"mr-1"},{default:s(()=>[...e[25]||(e[25]=[l("Detalhes",-1)])]),_:2},1032,["onClick"]),a(c,{size:"small",disabled:o.status==="Esgotado"||o.alunoInscrito,color:"green-darken-3",variant:"tonal",onClick:C=>ee(o)},{default:s(()=>[l(u(o.alunoInscrito?"Inscrito":"Inscrever-se"),1)]),_:2},1032,["disabled","onClick"])]))])]))),128))])]),_:1})]),_:1})):P("",!0)]))])),_.value!==2?(r(),v(Ce,{key:3,modelValue:A.value,"onUpdate:modelValue":e[3]||(e[3]=o=>A.value=o),title:W.value.title,fields:W.value.fields,item:K.value,loading:T.value,onSave:re},null,8,["modelValue","title","fields","item","loading"])):P("",!0)]),_:1})}}},Ye=pe(He,[["__scopeId","data-v-4fefd148"]]);export{Ye as default};
